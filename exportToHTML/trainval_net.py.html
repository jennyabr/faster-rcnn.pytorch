<html>
<head>
<title>trainval_net.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(204,120,50); }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(106,135,89); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
trainval_net.py</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import 
</span><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">division 
 
</span><span class="s0">import </span><span class="s1">argparse 
</span><span class="s0">import </span><span class="s1">logging 
</span><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np 
</span><span class="s0">import </span><span class="s1">torch 
</span><span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">partial 
 
</span><span class="s0">from </span><span class="s1">data_handler.data_manager_api </span><span class="s0">import </span><span class="s1">Mode 
</span><span class="s0">from </span><span class="s1">data_handler.detection_data_manager </span><span class="s0">import </span><span class="s1">FasterRCNNDataManager 
</span><span class="s0">from </span><span class="s1">loggers.tensorbord_logger </span><span class="s0">import </span><span class="s1">TensorBoardLogger 
</span><span class="s0">from </span><span class="s1">model.faster_rcnn.faster_rcnn_meta_arch </span><span class="s0">import </span><span class="s1">FasterRCNNMetaArch 
</span><span class="s0">from </span><span class="s1">model.faster_rcnn.faster_rcnn_training_session </span><span class="s0">import </span><span class="s1">run_training_session 
</span><span class="s0">from </span><span class="s1">model.feature_extractors.faster_rcnn_feature_extractors </span><span class="s0">import </span><span class="s1">create_feature_extractor_from_ckpt 
</span><span class="s0">from </span><span class="s1">util.config </span><span class="s0">import </span><span class="s1">ConfigProvider 
</span><span class="s0">from </span><span class="s1">util.logging </span><span class="s0">import </span><span class="s1">set_root_logger 
 
 
parser = argparse.ArgumentParser(description=</span><span class="s2">'Train a Faster R-CNN network'</span><span class="s1">) 
parser.add_argument(</span><span class="s2">'--config_path'</span><span class="s0">, </span><span class="s1">dest=</span><span class="s2">'config_path'</span><span class="s0">, </span><span class="s1">help=</span><span class="s2">'Path to config file'</span><span class="s0">, </span><span class="s1">type=str) 
args = parser.parse_args() 
</span><span class="s0">if not </span><span class="s1">args.config_path: 
    </span><span class="s0">raise </span><span class="s1">Exception(</span><span class="s2">&quot;Unable to run without config file.&quot;</span><span class="s1">) 
cfg = ConfigProvider() 
cfg.load(args.config_path) 
np.random.seed(cfg.RNG_SEED) 
 
set_root_logger(cfg.get_log_path()) 
logger = logging.getLogger(__name__) 
train_data_manager = FasterRCNNDataManager( 
    mode=Mode.TRAIN</span><span class="s0">, </span><span class="s1">imdb_name=cfg.imdb_name</span><span class="s0">, </span><span class="s1">num_workers=cfg.NUM_WORKERS</span><span class="s0">, </span><span class="s1">is_cuda=cfg.CUDA</span><span class="s0">, </span><span class="s1">cfg=cfg</span><span class="s0">,</span><span class="s1"> 
    batch_size=cfg.TRAIN.batch_size) 
train_logger = TensorBoardLogger(cfg.output_path) 
feature_extractors = create_feature_extractor_from_ckpt( 
    cfg.net</span><span class="s0">, </span><span class="s1">cfg.net_variant</span><span class="s0">, </span><span class="s1">frozen_blocks=cfg.TRAIN.frozen_blocks</span><span class="s0">,</span><span class="s1"> 
    pretrained_model_path=cfg.TRAIN.get(</span><span class="s2">&quot;pretrained_model_path&quot;</span><span class="s0">, None</span><span class="s1">)) 
model = FasterRCNNMetaArch.create_with_random_normal_init(feature_extractors</span><span class="s0">, </span><span class="s1">cfg</span><span class="s0">,</span><span class="s1"> 
                                                          num_classes=train_data_manager.num_classes) 
create_optimizer_fn = partial(torch.optim.SGD</span><span class="s0">, </span><span class="s1">momentum=cfg.TRAIN.MOMENTUM) 
 
run_training_session(train_data_manager</span><span class="s0">, </span><span class="s1">model</span><span class="s0">, </span><span class="s1">create_optimizer_fn</span><span class="s0">, </span><span class="s1">cfg</span><span class="s0">, </span><span class="s1">train_logger</span><span class="s0">, </span><span class="s1">cfg.TRAIN.start_epoch) 
</span></pre>
</body>
</html>